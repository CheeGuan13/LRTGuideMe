<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LRT GuideMe – Sign Up</title> <link rel="stylesheet" href="styles/style.css" />
  <script src="scripts/i18n.js" defer></script>
</head>
<body>
  <header class="container nav">
    <a class="brand" href="index.html">
      <img class="brand-logo" src="assets/images/LRT-Icon.png" alt="LRT Icon" />
      <span class="notranslate">LRT GuideMe</span>
    </a>
    <nav class="menu" style="display:flex;align-items:center;gap:12px;">
      <select id="langSelect" aria-label="Select language" style="padding:6px 10px;border:1px solid #ccc;border-radius:6px;">
        <option value="en">English</option>
        <option value="ms">Bahasa Melayu</option>
        <option value="zh">中文</option>
      </select>
    </nav>
  </header>

<main class="container" style="display:flex;justify-content:center;align-items:center;min-height:70vh;">
  <form id="signupForm" class="signup-box" action="signup.php" method="POST"
        style="width:100%;max-width:400px;padding:30px;border:1px solid #ddd;border-radius:10px;
               box-shadow:0 2px 6px rgba(0,0,0,0.1);background:#fff;">
    
    <h2 data-i18n-key="signup_title" style="text-align:center;margin-bottom:20px;">Create Your Account</h2>

    <label for="username" data-i18n-key="username_label" style="display:block;margin-bottom:6px;">Username</label>
    <input type="text" id="username" name="username" placeholder="Enter your username" required
           style="width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;margin-bottom:15px;">

    <label for="email" data-i18n-key="email_label" style="display:block;margin-bottom:6px;">Email</label>
    <input type="email" id="email" name="email" placeholder="Enter your email" required
           style="width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;margin-bottom:15px;">

    <label for="password" data-i18n-key="password_label" style="display:block;margin-bottom:6px;">Password</label>
    <input type="password" id="password" name="password" placeholder="Enter your password" required
           style="width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;margin-bottom:15px;">

    <label for="confirm_password" data-i18n-key="confirm_password_label" style="display:block;margin-bottom:6px;">Confirm Password</label>
    <input type="password" id="confirm_password" name="confirm_password" placeholder="Re-enter your password" required
           style="width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;margin-bottom:20px;">
           
    <p id="errorMsg" style="color:red;text-align:center;margin-bottom:15px;display:none;"></p>

    <button type="submit" class="btn primary" data-i18n-key="signup_button"
            style="width:100%;padding:10px;border:none;border-radius:6px;background:#0078d7;color:white;font-size:16px;cursor:pointer;">
      Register
    </button>

    <p style="text-align:center;margin-top:15px;font-size:14px;">
      <span data-i18n-key="have_account">Already have an account?</span>
      <a href="login.html" data-i18n-key="login_here" style="color:#0078d7;text-decoration:none;font-weight:500;">Login here</a>
    </p>
  </form>
</main>

<script>
document.getElementById('signupForm').addEventListener('submit', function(event) {
  const username = document.getElementById('username').value.trim();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value.trim();
  const confirmPassword = document.getElementById('confirm_password').value.trim();
  const errorMsg = document.getElementById('errorMsg');

  errorMsg.style.display = 'none';
  errorMsg.textContent = '';

  if (!username || !email || !password || !confirmPassword) {
    event.preventDefault();
    errorMsg.textContent = "Please fill in all fields."; // 可以考虑也把错误信息国际化
    errorMsg.style.display = 'block';
    return;
  }

  const emailPattern = /^[^ ]+@[^ ]+\.[a-z]{2,3}$/;
  if (!email.match(emailPattern)) {
    event.preventDefault();
    errorMsg.textContent = "Please enter a valid email address."; // 可以考虑也把错误信息国际化
    errorMsg.style.display = 'block';
    return;
  }

  if (password !== confirmPassword) {
    event.preventDefault();
    errorMsg.textContent = "Passwords do not match."; // 可以考虑也把错误信息国际化
    errorMsg.style.display = 'block';
    return;
  }

  if (password.length < 6) {
    event.preventDefault();
    errorMsg.textContent = "Password must be at least 6 characters long."; // 可以考虑也把错误信息国际化
    errorMsg.style.display = 'block';
    return;
  }

});
</script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const status = urlParams.get('status');
    const error = urlParams.get('error');
    const messageKey = status || error; // 获取 URL 中的 key (status 或 error)

    if (messageKey) {
      // 稍微等待一下，确保 i18n.js 已加载并可能已应用初始翻译
      setTimeout(() => {
        // 尝试获取当前语言设置
        const lang = window.currentLang || localStorage.getItem('preferredLang') || 'en';
        // 尝试获取翻译字典
        const tDict = (typeof translations !== 'undefined' && translations[lang]) ? translations[lang] : {};

        // 查找翻译文本，如果找不到，就用 key 本身或一个通用消息作为后备
        const message = tDict[messageKey] || messageKey.replace(/_/g, ' ') || 'An unknown message occurred.';

        alert(message); // 弹出翻译后的提示

        // (可选) 清理 URL 参数，这样刷新页面就不会再次弹出提示
        if (window.history.replaceState) {
           const cleanUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
           window.history.replaceState({path: cleanUrl}, '', cleanUrl);
        }
      }, 150); // 150毫秒的延迟通常足够了
    }
  });
</script>
</body>
</html>